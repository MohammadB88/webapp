node {
    stage('Initialize'){
        def dockerHome = tool 'mydocker'
        env.PATH = "${dockerHome}/bin:${env.PATH}"
    }
    def app
    stage('Clone repository') {
        checkout([$class: 'GitSCM', 
        branches: [[name: '*/main']],
        extensions: [
            [$class: 'SparseCheckoutPaths', 
            sparseCheckoutPaths:[[$class:'SparseCheckoutPath', path:'/fullstack/nginx']]]
            ],
        userRemoteConfigs: [[url: 'https://github.com/MohammadB88/webapp.git']]])
        sh "ls -ltr"
    }
    stage('build image') {
        app = docker.build("mohammad67/test:${env.BUILD_NUMBER}", "./fullstack/nginx")
    }
    stage('test') {
            sh 'echo Hello from Test Section'
    }
    stage('push image') {
        docker.withRegistry('https://registry.hub.docker.com', 'dockerhub') {
            def dockerHome = tool 'mydocker'
            env.PATH = "${dockerHome}/bin:${env.PATH}"
            app.push("mohammad67/test:${env.BUILD_NUMBER}") 
        }
    }
    stage('deploy') {
            sh 'echo Hello from Deploy Section'
    }
}

